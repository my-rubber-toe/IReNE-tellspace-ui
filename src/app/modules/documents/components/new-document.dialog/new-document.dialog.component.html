<!--Template for document creation form-->
<button mat-icon-button class="dialog-close-button" (click)="cancelAndClose()">
  <mat-icon class="close-icon" color="warn">close</mat-icon>
</button>
<h1 mat-dialog-title>Create Case Study</h1>
<div mat-dialog-content>
  <form
    class="create-form"
    [formGroup]="createDocumentForm"
    (ngSubmit)="onSubmit()"
  >
    <div id="language-radio-field">
      <label>Case Study Content Language:&ensp;</label>
      <mat-radio-group
        aria-label="Select a case language"
        formControlName="language"
      >
        <mat-radio-button value="English">English</mat-radio-button>
        <mat-radio-button value="Spanish">Spanish</mat-radio-button>
      </mat-radio-group>
    </div>
    <mat-form-field hintLabel="(min: 10 characters)" class="full-width">
      <input
        matInput
        formControlName="title"
        name="title"
        maxlength="100"
        minlength="10"
        placeholder="Case Study Title"
        [errorStateMatcher]="matcher"
        required
      />
      <mat-error
      *ngIf="createDocumentForm.controls['title'].invalid"
      >Title must hava at least 10 characters</mat-error
    >
    </mat-form-field>
    <mat-form-field hintLabel="MM/DD/YYYY" color="primary">
      <mat-label>Incident Date</mat-label>
      <input
        matInput
        [matDatepicker]="picker"
        formControlName="incident_date"
        name="incident_date"
        [min]="minDate"
        [max]="maxDate"
        [errorStateMatcher]="matcher"
        required
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Infrastructure Type</mat-label>
      <mat-select
        formControlName="infrastructure_type"
        multiple
        [errorStateMatcher]="matcher"
        required
      >
        <mat-option
          *ngFor="let infra_type of infrastructureList"
          [value]="infra_type"
          >{{ infra_type }}</mat-option
        >
      </mat-select>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Damage Type</mat-label>
      <mat-select
        formControlName="damage_type"
        multiple
        [errorStateMatcher]="matcher"
        required
      >
        <mat-option *ngFor="let dtype of damageTypeList" [value]="dtype">{{
          dtype
        }}</mat-option>
      </mat-select>
    </mat-form-field>
    <br />
    <div formArrayName="authors" class="container">
      <div
        *ngFor="
          let author of createDocumentForm.get('authors')['controls'];
          let i = index
        "
      >
        <div [formGroupName]="i">
          <mat-card>
            <mat-form-field class="full-width">
              <mat-label>Author {{ i + 1 }} Name</mat-label>
              <input
                formControlName="first_name"
                matInput
                maxlength="30"
                [errorStateMatcher]="matcher"
                required
              />
            </mat-form-field>
            <mat-form-field class="full-width">
              <mat-label>Author {{ i + 1 }} Lastname</mat-label>
              <input
                formControlName="last_name"
                matInput
                maxlength="30"
                [errorStateMatcher]="matcher"
                required
              />
            </mat-form-field>
            <br />
            <mat-form-field class="full-width">
              <mat-label>Author {{ i + 1 }} Email</mat-label>
              <input
                matInput
                #Email
                placeholder="irene.riseup@upr.edu"
                formControlName="email"
                maxlength="50"
                [errorStateMatcher]="matcher"
                required
              />
              <mat-error
                *ngIf="createDocumentForm.controls['authors'].invalid"
                >{{ getEmailErrorMessage() }}</mat-error
              >
            </mat-form-field>
            <mat-form-field class="full-width">
              <mat-label>Author {{ i + 1 }} Faculty</mat-label>
              <input
                formControlName="faculty"
                matInput
                maxlength="30"
                [errorStateMatcher]="matcher"
                required
              />
            </mat-form-field>
            <button
              *ngIf="i != 0"
              (click)="removeAuthor(i)"
              mat-icon-button
              matTooltip="Remove this author"
              color="warn"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card>
        </div>
      </div>
    </div>
    <button
      mat-raised-button
      color="primary"
      type="button"
      (click)="addAuthor()"
    >
      Add another author
    </button>

    <br />

    <div formArrayName="actors" class="container">
      <div
        *ngFor="
          let actor of createDocumentForm.get('actors')['controls'];
          let i = index
        "
      >
        <div [formGroupName]="i">
          <mat-card>
            <mat-form-field class="full-width">
              <mat-label>Actor {{ i + 1 }} Name</mat-label>
              <input
                formControlName="first_name"
                matInput
                maxlength="30"
                [errorStateMatcher]="matcher"
                required
              />
            </mat-form-field>
            <mat-form-field class="full-width">
              <mat-label>Actor {{ i + 1 }} Lastname</mat-label>
              <input
                formControlName="last_name"
                matInput
                maxlength="30"
                [errorStateMatcher]="matcher"
                required
              />
            </mat-form-field>
            <br />
            <mat-form-field class="full-width">
              <mat-label>Actor {{ i + 1 }} Role</mat-label>
              <input
                formControlName="role"
                matInput
                maxlength="30"
                [errorStateMatcher]="matcher"
                required
              />
            </mat-form-field>

            <button
              *ngIf="i != 0"
              (click)="removeActor(i)"
              mat-icon-button
              matTooltip="Remove Actor"
              color="warn"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card>
        </div>
      </div>
    </div>
    <button
      mat-raised-button
      color="primary"
      type="button"
      (click)="addActor()"
    >
      Add another actor
    </button>
    <div mat-dialog-actions>
      <button
        class="full-width"
        mat-raised-button
        color="accent"
        type="submit"
        [disabled]="createDocumentForm.invalid"
      >
        Submit
      </button>
    </div>
  </form>
</div>
